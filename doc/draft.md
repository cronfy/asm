# Документация 

Имеющийся движок сайта ниже называется legacy. Новый движок - yii.

## Коннектор для CMS

### 1. Внедрение на ранней стадии инициализации приложения

Используется самая ранняя точка, общая для всех скриптов.

Решаемые задачи:

  1. Управление конфигурацией legacy, используя env (например, настройки БД).
  2. Прероутинг - перехват запросов для направления их либо в приложение Yii, либо в legacy.
  3. Возможность подготовить данные с помощью приложения Yii, но вывести их далее средствами
  legacy.
  
### 2. Прероутинг

Варианты работы:

 1. Полный перехват запроса и возврат ответа.
 2. Перехват запроса, подготовка данных, обеспечение доступа к ним из legacy.
  
### 3. Yii, потом legacy

Сначала будет выполнен код yii, потом код legacy.

`Yii::$app` является единым для yii и legacy.

При этом должна быть обеспечена совместимая работа с артефактами*.

*Артефакты: сессии, куки, заголовки, ассеты, метатеги.

Это означает, что:

 1. Вся работа с артефактами ведется средствами Yii.
 2. Из legacy доступен `Yii::$app` с результатами работы yii.
 3. В legacy вся работа с артефактами также ведется средствами Yii.
 4. В legacy, в конце обработки запроса, когда все данные уже подготовлены, необходимо
 обеспечить корректное внедрение артефактов в результаты обработки запроса.
 
### 4. Точка выхода

Точка выхода обеспечивает внедрение в результат обработки запроса артефактов, установленных
средствами Yii.